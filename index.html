<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./styles.css">
</head>

<body>
    <div id="root"></div>
   <script type="module">
    

import { render, createElement } from './core/dom.js';
import { useState } from './core/state.js';
import { Button, Div, H1, Input, Ul, Li, P } from './core/dom.js';

const TestNested = ({count}) => {
    const persons = ["alice", "bob", "charlie"];
    const [search, setSearch] = useState("");
    return Div({}, [
        P({}, [`This is a passed state prop: ${count}`]),
        Input({ value: search, oninput: (e) => setSearch(e.target.value) }),
        Ul({}, persons.filter(p => p.includes(search)).map(p => Li({}, [p])))
    ])
}

function TodoList() {
    const [todos, setTodos] = useState([]);
    const [input, setInput] = useState("");
    const [count, setCount] = useState(0);
    const [error, setError] = useState(null);


    
    return Div({ className: "todo-list" }, [
        H1({ className: "title" }, ["Todo List"]),
        Input({className: error ? "error" : "input", type: "text", placeholder: "Add a todo", value: input, oninput: (e) => {
            if (todos.includes(e.target.value)) {
                setError("exists")
            }else{
                setError(null)
            }
            setInput(e.target.value)
        } }),
        Button({ onClick: () => setTodos(() => {
            if (input === "") {
                return todos;
            }
            if (todos.includes(input)) {
                setError("exists");
                return todos;
            }
            setError(null);
            return [input, ...todos];
        })}, ["Add Todo"]),
        Button({ onClick: () => setTodos([])}, ["Clear Todos"]),
        Button({ onClick: ()=> setTodos([input, ...todos])}, ["prepend todo"]),
        Ul( { className: "todo-list" }, 
            todos.map((todo, index) => Li({ className: "todo", key: index }, [todo, Button({ onClick: () => setTodos(todos.filter(t => t !== todo))}, ["X"])]))
        ),
        Button({ onClick: () => setCount(count + 1)}, ["Increment"]),
        Button({ onClick: () => setCount(count - 1)}, ["Decrement"]),
        P({ className: "count" }, [count]),
        TestNested({count : count}, [])
    ]);
}


render(TodoList);

   </script>
</body>

</html>